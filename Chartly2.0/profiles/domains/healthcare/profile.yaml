profile:
  name: "domains/healthcare"
  description: >
    Healthcare domain overlay. Inherits from core/base and enforces PHI-safe handling.
    This profile tightens cleansing, logging, access expectations, quarantine escalation, and retention
    to support HIPAA-aligned operation and defensible audit trails.
  domain: "healthcare"
  version: "1.0.0"
  status: "active"
  owners:
    - "Chartly Maintainers"
  created_at: "2026-01-21T00:00:00Z"
  updated_at: "2026-01-21T00:00:00Z"

inherits:
  base_profile: "profiles/core/base/profile.yaml"
  overridden_files:
    - "mappings.yaml"
    - "phi_handling.yaml"
    - "retention.yaml"

classification:
  data_sensitivity: "phi"
  handling_notes:
    - "Assume PHI may exist in raw payloads."
    - "Canonical outputs must minimize PHI; prefer aggregate metrics and opaque identifiers."
    - "Never log raw payload content or PHI fields."
    - "Any suspected PHI leakage into canonical outputs must trigger quarantine and a case."
  prohibitions:
    - "no_patient_names_in_dimensions"
    - "no_addresses_in_dimensions"
    - "no_full_dates_of_birth_in_dimensions"
    - "no_free_text_clinical_notes_in_canonical"
  allowed_storage:
    raw: true
    canonical: true
    audit: true

compliance:
  hipaa: true
  minimum_controls:
    - "RBAC enforced at gateway for all healthcare endpoints."
    - "Raw plane access restricted to least-privileged roles."
    - "Audit plane append-only with verification."
    - "PHI handling rules enforced by normalizer."
  breach_response:
    - "If PHI leakage detected, suspend source ingestion and open a critical case."
    - "Initiate incident response workflow and credential review if applicable."

scope:
  supported_source_kinds: ["api", "db", "file", "webhook"]
  supported_connector_types:
    - "http_rest"
    - "graphql"
    - "database"
    - "file_system"
    - "webhook"
  notes:
    - "Domain ingestion (rss/domain_fetch) is discouraged for PHI contexts unless explicitly justified."

canonicalization_overrides:
  dimension_policy:
    max_dimensions_per_record: 32
    max_dimension_key_len: 48
    max_dimension_value_len: 128
    allowlist_keys:
      enabled: true
      allowed:
        - "facility_id"
        - "department"
        - "encounter_type"
        - "provider_id_hash"
        - "region"
        - "interval"
    notes:
      - "Dimensions are restricted to prevent PHI leakage."
      - "Any dimension key outside allowlist should be dropped or quarantined per phi_handling.yaml."

quarantine_overrides:
  escalation_rules:
    - when: "policy.pii_phi_violation"
      action: "open_case"
      severity: "critical"
    - when: "policy.secret_detected"
      action: "open_case"
      severity: "critical"
    - when: "schema.validation_failed"
      action: "open_case"
      severity: "high"
  notes:
    - "Healthcare domain treats PHI violations as critical incidents."

policy_references:
  mappings: "profiles/domains/healthcare/mappings.yaml"
  phi_handling: "profiles/domains/healthcare/phi_handling.yaml"
  retention: "profiles/domains/healthcare/retention.yaml"

llm_workers_overrides:
  enabled: true
  safe_mode_default: true
  lanes:
    - lane: "drift_analysis"
      purpose: "Explain schema drift and propose mapping patches WITHOUT PHI exposure."
      model: "llama3.1:8b"
      allowed_roles: ["schema_drift_explainer", "mapping_suggester"]
      approval_gate: "human_required"
      constraints:
        - "LLM must not be given raw PHI payloads."
        - "Use redacted/minimized samples only (remove PHI before prompting)."
        - "All suggestions require validation and review."
    - lane: "reporting_specs"
      purpose: "Suggest report/chart config structure (no PHI content)."
      model: "llama3.1:8b"
      allowed_roles: ["report_spec_assistant"]
      approval_gate: "human_required"
      constraints:
        - "Reports must use aggregated data and non-identifying dimensions."
  forbidden:
    - "llm_sees_raw_phi"
    - "auto_apply_profile_changes"
    - "auto_unquarantine"
  audit_requirements:
    required: true
    record_fields:
      - "ts"
      - "tenant_id"
      - "source_id"
      - "profile_name"
      - "profile_version"
      - "llm_role"
      - "model_id"
      - "prompt_hash"
      - "output_hash"
      - "decision"
      - "approver"

observability_overrides:
  logging:
    phi_safe: true
    prohibited_fields:
      - "patient_name"
      - "address"
      - "dob"
      - "clinical_notes"
      - "raw_payload"
    required_fields:
      - "ts"
      - "level"
      - "service"
      - "env"
      - "tenant_id"
      - "request_id"
      - "job_id"
      - "source_id"
      - "profile_name"
      - "profile_version"
  metrics:
    additional_metrics:
      - "healthcare.phi_quarantine_total"
      - "healthcare.access_denied_total"

# -----------------------------------------------------------------------------
# EXAMPLES (comments only)
#
# Example: Domain overlay forbids non-allowlisted dimensions (drop + quarantine signal)
# canonicalization_overrides:
#   dimension_policy:
#     allowlist_keys:
#       enabled: true
#       allowed: ["facility_id", "department", "encounter_type"]
# -----------------------------------------------------------------------------
