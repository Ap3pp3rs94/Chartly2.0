# Chartly Helm Chart  Default Values (provider-neutral, no secrets)
# NOTE: This file intentionally contains NO credentials. Use Secrets via overlays for any auth.

global:
  namespace: chartly

  # Global labels applied to all resources (NOT used for Service selectors by default).
  labels:
    app.kubernetes.io/name: chartly
    app.kubernetes.io/part-of: chartly
    app.kubernetes.io/instance: chartly
    app.kubernetes.io/managed-by: helm
    app.kubernetes.io/version: dev

  image:
    # Optional registry prefix for private registries / airgapped deployments.
    # Example: "registry.local/library"
    registry: ""
    pullPolicy: IfNotPresent

  security:
    automountServiceAccountToken: false

    pod:
      runAsNonRoot: true
      runAsUser: 10001
      runAsGroup: 10001
      fsGroup: 10001
      seccompProfile:
        type: RuntimeDefault
      terminationGracePeriodSeconds: 30

    container:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop: ["ALL"]

# Components/services
# CRITICAL: Each component defines selectorLabels used by Services to select ONLY its Pods.
# Consistency: each component includes security + writablePaths override hooks (even if inheriting globals).
services:
  gateway:
    enabled: true
    component: gateway
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: gateway
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-gateway
      tag: dev
    service:
      type: ClusterIP
      port: 8080
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

  orchestrator:
    enabled: true
    component: orchestrator
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: orchestrator
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-orchestrator
      tag: dev
    service:
      type: ClusterIP
      port: 8081
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

  connectorHub:
    enabled: true
    component: connector-hub
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: connector-hub
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-connector-hub
      tag: dev
    service:
      type: ClusterIP
      port: 8082
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

  normalizer:
    enabled: true
    component: normalizer
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: normalizer
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-normalizer
      tag: dev
    service:
      type: ClusterIP
      port: 8083
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

  analytics:
    enabled: true
    component: analytics
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: analytics
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-analytics
      tag: dev
    service:
      type: ClusterIP
      port: 8084
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

  storage:
    enabled: true
    component: storage
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: storage
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-storage
      tag: dev
    service:
      type: ClusterIP
      port: 8085
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

  audit:
    enabled: true
    component: audit
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: audit
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-audit
      tag: dev
    service:
      type: ClusterIP
      port: 8086
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

  auth:
    enabled: true
    component: auth
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: auth
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-auth
      tag: dev
    service:
      type: ClusterIP
      port: 8087
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

  observer:
    enabled: true
    component: observer
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: observer
      app.kubernetes.io/instance: chartly
    image:
      repository: chartly-observer
      tag: dev
    service:
      type: ClusterIP
      port: 8088
      name: http
    security: {}
    writablePaths:
      tmp: { enabled: true, mountPath: /tmp }
    probes:
      readiness: { path: /ready,  initialDelaySeconds: 3,  periodSeconds: 5 }
      liveness:  { path: /health, initialDelaySeconds: 10, periodSeconds: 10 }
      startup:   { path: /health, periodSeconds: 2, failureThreshold: 30 }
    resources:
      requests: { cpu: 50m, memory: 128Mi }
      limits:   { cpu: 250m, memory: 256Mi }

ingress:
  enabled: true
  className: "REPLACE_ME"
  host: "chartly.local"
  tls:
    enabled: false
  routes:
    - { name: root,         path: /,            pathType: Prefix, serviceName: chartly-gateway,        servicePortName: http }
    - { name: health,       path: /health,      pathType: Exact,  serviceName: chartly-gateway,        servicePortName: http }
    - { name: analytics,    path: /analytics,   pathType: Prefix, serviceName: chartly-analytics,      servicePortName: http }
    - { name: audit,        path: /audit,       pathType: Prefix, serviceName: chartly-audit,          servicePortName: http }
    - { name: auth,         path: /auth,        pathType: Prefix, serviceName: chartly-auth,           servicePortName: http }
    - { name: connectors,   path: /connectors,  pathType: Prefix, serviceName: chartly-connector-hub,  servicePortName: http }
    - { name: normalize,    path: /normalize,   pathType: Prefix, serviceName: chartly-normalizer,     servicePortName: http }
    - { name: observer,     path: /observer,    pathType: Prefix, serviceName: chartly-observer,       servicePortName: http }
    - { name: orchestrator, path: /orchestrator,pathType: Prefix, serviceName: chartly-orchestrator,   servicePortName: http }
    - { name: storage,      path: /storage,     pathType: Prefix, serviceName: chartly-storage,        servicePortName: http }

monitoring:
  prometheus:
    enabled: true
    component: prometheus
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: prometheus
      app.kubernetes.io/instance: chartly
    image:
      repository: prom/prometheus
      tag: v2.52.0
    service:
      port: 9090
      name: http
    security: {}
    writablePaths:
      tmp:  { enabled: true, mountPath: /tmp }
      data: { enabled: true, mountPath: /prometheus }
    scrape:
      metricsPath: /metrics

  grafana:
    enabled: true
    component: grafana
    selectorLabels:
      app.kubernetes.io/name: chartly
      app.kubernetes.io/component: grafana
      app.kubernetes.io/instance: chartly
    image:
      repository: grafana/grafana
      tag: 10.4.6
    service:
      port: 3000
      name: http
    security:
      runAsUser: 472
      runAsGroup: 472
      fsGroup: 472
    writablePaths:
      tmp:  { enabled: true, mountPath: /tmp }
      data: { enabled: true, mountPath: /var/lib/grafana }
