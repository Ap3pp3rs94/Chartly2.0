{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/Ap3pp3rs94/Chartly2.0/contracts/v1/canonical/audit_record.schema.json",
  "title": "Chartly Canonical AuditRecord (v1)",
  "description": "An AuditRecord is an append-only ledger entry describing an action taken by a service or user. Records may be chained via prev_hash to provide tamper evidence.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "minLength": 1,
      "description": "Stable audit record identifier (ULID recommended)."
    },
    "ts": {
      "type": "string",
      "format": "date-time",
      "description": "RFC3339 timestamp when the audit record was written."
    },
    "actor": {
      "type": "string",
      "minLength": 1,
      "description": "Actor performing the action (service name, user id, or system identity)."
    },
    "action": {
      "type": "string",
      "minLength": 1,
      "description": "Action identifier (e.g., ingest.fetch, normalize.write, auth.policy_eval)."
    },
    "subject": {
      "type": "string",
      "minLength": 1,
      "description": "Identifier of the subject being acted upon (object id)."
    },
    "subject_type": {
      "type": "string",
      "minLength": 1,
      "description": "Type of the subject (e.g., Source, Metric, Event, Artifact, Case)."
    },
    "prev_hash": {
      "description": "Previous audit hash in the chain (null if chain start).",
      "oneOf": [
        { "type": "string", "pattern": "^[a-fA-F0-9]{64}$" },
        { "type": "null" }
      ]
    },
    "hash": {
      "type": "string",
      "pattern": "^[a-fA-F0-9]{64}$",
      "description": "SHA-256 hex digest of this record (computed over canonicalized record content + prev_hash)."
    },
    "details": {
      "type": "object",
      "description": "Audit details (structured). Must not include secrets. May include raw_ref/canonical ids/job ids.",
      "additionalProperties": true
    },
    "tenant_id": {
      "type": "string",
      "minLength": 1,
      "description": "Tenant scope identifier."
    }
  },
  "required": [
    "id",
    "ts",
    "actor",
    "action",
    "subject",
    "subject_type",
    "prev_hash",
    "hash",
    "details",
    "tenant_id"
  ]
}
