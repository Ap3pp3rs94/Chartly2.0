# Chartly 2.0  Orchestrator configuration
#
# NOTE (IMPORTANT):
# - Current runtime behavior is driven by ENV vars in cmd/orchestrator/main.go.
# - This file is a production-ready scaffold for future expansion.
# - Sections marked "ROADMAP" are NOT implemented yet and MUST be treated as placeholders.

service:
  name: orchestrator
  # env: local|dev|stage|prod (ROADMAP: file-based config loading)
  env: local
  addr: ":8081"

  timeouts_ms:
    read: 5000
    write: 10000
    idle: 60000
    shutdown: 10000

  max_header_bytes: 1048576

headers:
  request_id: "X-Request-Id"
  tenant_id: "X-Tenant-Id"

cors:
  # IMPLEMENTED (local behavior): main.go enables permissive CORS when env=local.
  enabled: true
  allow_origins: ["*"]
  allow_methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  allow_headers: ["Content-Type", "Authorization", "X-Request-Id", "X-Tenant-Id"]
  expose_headers: ["X-Request-Id"]

logging:
  # IMPLEMENTED: JSON lines to stdout via stdlib logger wrapper.
  format: json
  level: info

ingest_api:
  # IMPLEMENTED (STUB): /ingest/enqueue exists but does not dispatch work yet.
  enabled: true

  endpoints:
    enqueue: true
    job_get: true

  # ROADMAP: gateway-style rate limiting / tenant-level quotas
  rate_limit:
    enabled: false
    rps: 5
    burst: 10

scheduler:
  # ROADMAP: cron/ticker scheduler to trigger jobs automatically.
  enabled: false
  timezone: "America/Chicago"
  crons: []
  # example:
  # crons:
  #   - name: "nightly-ingest"
  #     cron: "0 2 * * *"
  #     job_type: "ingest"
  #     source_id: "source-123"

queue:
  # ROADMAP: Redis-backed queue used to dispatch to connector-hub / workers.
  enabled: false
  provider: redis

  redis:
    addr: "127.0.0.1:6379"
    password: ""
    db: 0
    tls: false

  # ROADMAP: queue keys/streams
  keys:
    ingest: "chartly:orchestrator:ingest"
    dlq: "chartly:orchestrator:dlq"

workers:
  # ROADMAP: worker pool consuming from queue with bounded concurrency.
  enabled: false
  concurrency: 4
  max_inflight: 100

jobs:
  # ROADMAP: job state tracking & retention policy.
  state_store:
    enabled: false
    provider: "postgres"   # or redis|sqlite|eventlog (future)
    dsn: ""

  retention:
    enabled: false
    days: 7

  retry:
    # ROADMAP: retry/backoff policy (used by consumer + dispatcher)
    enabled: false
    max_attempts: 5
    backoff_ms:
      initial: 250
      max: 30000
      multiplier: 2.0
      jitter: 0.25

telemetry:
  # ROADMAP: metrics/tracing (OTEL, Prometheus, etc.)
  enabled: false
  metrics:
    enabled: false
  tracing:
    enabled: false
