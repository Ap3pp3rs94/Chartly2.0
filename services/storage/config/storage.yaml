# Chartly 2.0  Storage Service Configuration (v0)
#
# This service is intentionally minimal in v0:
# - Object API is IN-MEMORY ONLY (no persistence).
# - Suitable for local development and early integration tests.
# - Future versions should wire durable storage (filesystem, S3, blob store, etc.)
#   behind the same HTTP API surface.

storage:
  # Environment mode:
  # - local: missing X-Tenant-Id defaults to "local"
  # - anything else: X-Tenant-Id is required for /v0/* endpoints unless overridden
  env:
    var: STORAGE_ENV
    default: local
    allowed: [local, dev, staging, prod]

  # Bind address / port
  addr:
    var: STORAGE_ADDR
    default: "0.0.0.0"

  port:
    var: STORAGE_PORT
    default: 8083

  # Server timeouts (Go time.ParseDuration format, e.g. "10s", "1m")
  read_timeout:
    var: STORAGE_READ_TIMEOUT
    default: "10s"

  write_timeout:
    var: STORAGE_WRITE_TIMEOUT
    default: "30s"

  idle_timeout:
    var: STORAGE_IDLE_TIMEOUT
    default: "60s"

  shutdown_timeout:
    var: STORAGE_SHUTDOWN_TIMEOUT
    default: "10s"

  # Request safety limits
  max_object_bytes:
    var: STORAGE_MAX_OBJECT_BYTES
    default: 52428800 # 50 MiB

  max_header_bytes:
    var: STORAGE_MAX_HEADER_BYTES
    default: 1048576 # 1 MiB

  # Tenant enforcement override (optional):
  # - When set, forces tenant requirement behavior regardless of STORAGE_ENV.
  # - Values: true/false, 1/0, yes/no, on/off
  require_tenant_override:
    var: STORAGE_REQUIRE_TENANT
    default: ""  # empty => derived from STORAGE_ENV

tenant_behavior:
  local:
    description: >
      When STORAGE_ENV=local, X-Tenant-Id is optional for /v0/*.
      If missing, tenant_id defaults to "local".
  non_local:
    description: >
      When STORAGE_ENV!=local, X-Tenant-Id is required for /v0/*.
      Requests missing the header will be rejected with a 400 error.

notes:
  - "v0 storage is in-memory only; all objects are lost on restart."
  - "Upgrade path: replace in-memory store with durable backend without changing the HTTP API."
