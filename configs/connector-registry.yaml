registry_version: "1.0"
default_connector: "http_rest"

discovery:
  status: "roadmap"
  strategies:
    - "openapi_probe"
    - "rss_autodiscovery"
    - "sitemap_probe"
    - "well_known_probe"
  openapi_paths:
    - "/openapi.json"
    - "/swagger.json"
    - "/.well-known/openapi.json"
  rss_hints:
    rel_alternate: true
    common_paths:
      - "/feed"
      - "/rss"
      - "/atom"
  sitemap_paths:
    - "/sitemap.xml"

connector_types:
  - id: "http_rest"
    kind: "api"
    protocol: "http_rest"
    capabilities: ["fetch", "paginate", "headers", "query_params", "json"]
    auth_modes: ["none", "api_key", "bearer", "basic", "oauth2"]
    required_config_keys: ["base_url", "paths"]
    optional_config_keys: ["headers", "params", "timeout_seconds", "rate_limit_rpm", "retries", "pagination"]
    defaults:
      timeout_seconds: 30
      rate_limit_rpm: 120
      retries:
        max_attempts: 3
        base_backoff_ms: 500
        max_backoff_ms: 8000
      headers:
        # Use env-var references for secrets:
        # Example: Authorization: "Bearer ${ENV:API_TOKEN}"
        User-Agent: "Chartly/2.0"
    notes: "Generic JSON HTTP GET connector; extend for POST/streaming as needed."

  - id: "graphql"
    kind: "api"
    protocol: "graphql"
    capabilities: ["fetch", "post", "json", "variables"]
    auth_modes: ["none", "api_key", "bearer", "basic", "oauth2"]
    required_config_keys: ["endpoint", "query"]
    optional_config_keys: ["variables", "headers", "timeout_seconds", "rate_limit_rpm", "retries"]
    defaults:
      timeout_seconds: 30
      rate_limit_rpm: 60
      retries:
        max_attempts: 3
        base_backoff_ms: 750
        max_backoff_ms: 12000
      headers:
        User-Agent: "Chartly/2.0"

  - id: "websocket"
    kind: "api"
    protocol: "websocket"
    capabilities: ["stream", "reconnect", "message_filter"]
    auth_modes: ["none", "api_key", "bearer", "basic"]
    required_config_keys: ["url"]
    optional_config_keys: ["headers", "timeout_seconds", "reconnect", "subscriptions"]
    defaults:
      timeout_seconds: 30
      reconnect:
        max_attempts: 10
        backoff_ms: 1000
      headers:
        User-Agent: "Chartly/2.0"

  - id: "grpc"
    kind: "api"
    protocol: "grpc"
    capabilities: ["rpc", "tls", "stream"]
    auth_modes: ["none", "api_key", "bearer"]
    required_config_keys: ["target", "service", "method"]
    optional_config_keys: ["timeout_seconds", "metadata", "tls"]
    defaults:
      timeout_seconds: 20
      tls:
        enabled: true

  - id: "database"
    kind: "db"
    protocol: "database"
    capabilities: ["query", "incremental", "cdc"]
    auth_modes: ["none", "basic"]
    required_config_keys: ["dsn_env", "query"]
    optional_config_keys: ["timeout_seconds", "incremental_key", "batch_size"]
    defaults:
      timeout_seconds: 60
      batch_size: 10000
    notes: "dsn_env references an environment variable that holds the DB DSN."

  - id: "sftp"
    kind: "file"
    protocol: "sftp"
    capabilities: ["list", "download", "checksum"]
    auth_modes: ["basic"]
    required_config_keys: ["host", "port", "username_env", "password_env", "paths"]
    optional_config_keys: ["timeout_seconds", "rate_limit_rpm"]
    defaults:
      timeout_seconds: 60
      rate_limit_rpm: 30

  - id: "s3"
    kind: "file"
    protocol: "s3"
    capabilities: ["list", "download", "etag", "prefix"]
    auth_modes: ["api_key"]
    required_config_keys: ["endpoint_env", "region_env", "access_key_env", "secret_key_env", "bucket", "prefix"]
    optional_config_keys: ["timeout_seconds"]
    defaults:
      timeout_seconds: 60

  - id: "rss"
    kind: "domain"
    protocol: "rss"
    capabilities: ["fetch", "parse", "dedupe"]
    auth_modes: ["none"]
    required_config_keys: ["url"]
    optional_config_keys: ["timeout_seconds", "rate_limit_rpm"]
    defaults:
      timeout_seconds: 20
      rate_limit_rpm: 60

  - id: "webhook"
    kind: "webhook"
    protocol: "webhook"
    capabilities: ["receive", "verify_signature", "ack"]
    auth_modes: ["none", "api_key"]
    required_config_keys: ["path"]
    optional_config_keys: ["signature_header", "signing_secret_env"]
    defaults:
      signature_header: "X-Signature"
    notes: "Inbound webhooks are terminated at gateway; connector-hub may translate into pipeline jobs."

  - id: "domain_fetch"
    kind: "domain"
    protocol: "domain_fetch"
    capabilities: ["fetch", "html_preview", "json_if_available"]
    auth_modes: ["none"]
    required_config_keys: ["url"]
    optional_config_keys: ["timeout_seconds", "rate_limit_rpm", "follow_redirects"]
    defaults:
      timeout_seconds: 20
      rate_limit_rpm: 60
      follow_redirects: true
