name: "sustained_load"
description: "Sustained moderate concurrency load to observe stability, latency drift, and resource behavior over time."
safety:
  opt_in_env: "CHARTLY_LOAD=1"
  notes:
    - "CAUTION: Sustained load can degrade performance and destabilize a dev stack."
    - "Run only against an environment you control (never against production)."
    - "Monitor CPU/RAM/DB latency, error rates, and saturation during the full duration."
    - "If errors or latency spike, stop the run and reduce concurrency."
target:
  base_url_env: "CHARTLY_BASE_URL"
  default_endpoint: "/health"
load:
  requests: 60000
  concurrency: 200
  timeout_sec: 10
  duration_sec: 600
run:
  command: >
    powershell -NoProfile -ExecutionPolicy Bypass -Command
    "$env:CHARTLY_LOAD='1'; $env:CHARTLY_BASE_URL='http://localhost:8080';
    $end=(Get-Date).AddSeconds(600); $total=0; $target=60000; $batch=1000;
    while((Get-Date) -lt $end -and $total -lt $target){
      & 'C:\Chartly2.0\tests\load\run_load.ps1' -BaseUrl $env:CHARTLY_BASE_URL
      -Endpoint '/health' -N $batch -C 200 -TimeoutSec 10;
      $total += $batch;
    }"
assumptions:
  - "A POSIX shell is available on Windows (Git Bash or WSL) and configured (CHARTLY_SH if needed)."
  - "The target may enforce rate limits; adjust concurrency if 429s occur."
  - "You are collecting metrics/logs during the run (gateway latency, DB load, error rates)."
  - "This profile stops when either duration_sec elapses or requests target is reached (batch-based)."
